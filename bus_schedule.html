<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IIITB Bus Schedule Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Manifest for PWA -->
    <link rel="manifest" href="manifest.json">
    <!-- Theme color for Android Chrome -->
    <meta name="theme-color" content="#4f46e5"/>
    <!-- App Icons -->
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/4f46e5/ffffff?text=IIITB">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .active-route {
            background-color: #4f46e5; /* Indigo */
            color: white;
            box-shadow: 0 4px 14px 0 rgba(79, 70, 229, 0.39);
        }
        .next-bus {
            background-color: #dcfce7; /* Light green for highlighting */
            border-left: 4px solid #22c55e; /* Solid green border */
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% {
                background-color: #dcfce7;
            }
            50% {
                background-color: #bbf7d0;
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl mx-auto bg-white rounded-2xl shadow-lg p-6 md:p-8">

        <!-- Header Section -->
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">IIITB Bus Schedule</h1>
            <p id="current-time" class="text-gray-500 mt-2 text-lg"></p>
        </div>

        <!-- Schedule Viewer Section -->
        <div id="schedule-viewer">
            <!-- Controls: Route and Day Selection -->
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
                <div class="relative flex w-full md:w-auto p-1 bg-gray-200 rounded-full">
                    <button id="to-iiitb" class="w-1/2 md:w-auto px-6 py-2 text-sm font-medium rounded-full transition-all duration-300">Uniworld to IIITB</button>
                    <button id="from-iiitb" class="w-1/2 md:w-auto px-6 py-2 text-sm font-medium rounded-full transition-all duration-300">IIITB to Uniworld</button>
                </div>
                <div>
                    <select id="day-selector" class="w-full md:w-auto bg-white border border-gray-300 text-gray-700 py-2 px-4 pr-8 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="0">Sunday</option>
                        <option value="1">Monday</option>
                        <option value="2">Tuesday</option>
                        <option value="3">Wednesday</option>
                        <option value="4">Thursday</option>
                        <option value="5">Friday</option>
                        <option value="6">Saturday</option>
                    </select>
                </div>
            </div>

            <!-- Schedule Display Table -->
            <div class="overflow-x-auto rounded-lg border border-gray-200 max-h-96">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Departure Time</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Bus Number</th>
                        </tr>
                    </thead>
                    <tbody id="schedule-body" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
            </div>
             <div class="text-center mt-4 text-sm text-gray-400">
               <!-- <p>Bus schedule data is dynamically loaded.</p> -->
            </div>
        </div>
    </div>
    
    <!-- External file for bus schedule data -->
    <script src="bus_data.js"></script>
    
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // Register the service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('Service worker registered successfully', reg))
                .catch(err => console.error('Service worker registration failed', err));
        }

        // DOM Elements
        const toIiitbBtn = document.getElementById('to-iiitb');
        const fromIiitbBtn = document.getElementById('from-iiitb');
        const daySelector = document.getElementById('day-selector');
        const scheduleBody = document.getElementById('schedule-body');
        const currentTimeEl = document.getElementById('current-time');

        let currentRoute = 'uniworldToIiitb';

        function timeTo24(timeStr) {
            if (!timeStr) return 0;
            const [time, modifier] = timeStr.split(' ');
            let [hours, minutes] = time.split(':');
            if (hours === '12') hours = '00';
            if (modifier === 'PM') hours = parseInt(hours, 10) + 12;
            return parseInt(`${hours}${minutes}`);
        }
        
        function displaySchedule(route, day) {
            scheduleBody.innerHTML = '';
            const data = scheduleData[route];
            
            const now = new Date();
            const currentTime24 = now.getHours() * 100 + now.getMinutes();
            const currentDay = now.getDay();
            let nextBusFound = false;

            data.forEach(item => {
                const bus = item.days[day];

                if (bus) {
                    const row = document.createElement('tr');
                    let highlightClass = '';
                    const itemTime24 = timeTo24(item.time);
                    
                    if (parseInt(day) === currentDay && !nextBusFound && itemTime24 >= currentTime24) {
                        highlightClass = 'next-bus';
                        row.id = 'next-bus-row'; // Add an ID to scroll to
                        nextBusFound = true;
                    }

                    row.className = `transition-colors duration-200 hover:bg-gray-50 ${highlightClass}`;
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-medium text-gray-900">${item.time}</div></td>
                        <td class="px-6 py-4 whitespace-nowrap"><span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${String(bus).includes('No') ? 'bg-red-100 text-red-800' : 'bg-indigo-100 text-indigo-800'}">${bus}</span></td>`;
                    scheduleBody.appendChild(row);
                }
            });

             if (scheduleBody.innerHTML === '') {
                scheduleBody.innerHTML = `<tr><td colspan="2" class="text-center py-10 px-6 text-gray-500">No buses scheduled for this day.</td></tr>`;
            }

            // After the table is built, find the next bus and scroll to it
            const nextBusRow = document.getElementById('next-bus-row');
            if (nextBusRow) {
                // Use a timeout to ensure the DOM is fully updated before scrolling
                setTimeout(() => {
                    nextBusRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        }

        function updateTime() {
            const now = new Date();
            currentTimeEl.textContent = now.toLocaleString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true });
        }
        
        toIiitbBtn.addEventListener('click', () => {
            currentRoute = 'uniworldToIiitb';
            toIiitbBtn.classList.add('active-route');
            fromIiitbBtn.classList.remove('active-route');
            displaySchedule(currentRoute, daySelector.value);
        });

        fromIiitbBtn.addEventListener('click', () => {
            currentRoute = 'iiitbToUniworld';
            fromIiitbBtn.classList.add('active-route');
            toIiitbBtn.classList.remove('active-route');
            displaySchedule(currentRoute, daySelector.value);
        });

        daySelector.addEventListener('change', () => {
            displaySchedule(currentRoute, daySelector.value);
        });

        function initializeScheduler() {
            const today = new Date().getDay();
            daySelector.value = today;
            toIiitbBtn.classList.add('active-route');
            displaySchedule(currentRoute, daySelector.value);
        }

        updateTime();
        setInterval(updateTime, 1000);
        
        if (typeof scheduleData !== 'undefined') {
            initializeScheduler();
        } else {
            scheduleBody.innerHTML = `<tr><td colspan="2" class="text-center py-10 px-6 text-red-500">Error: Could not load bus_data.js. Make sure the file exists and is correctly formatted.</td></tr>`;
        }
    });
    </script>
</body>
</html>

